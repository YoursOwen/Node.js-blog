#!/usr/bin/env node

/**!
 * cnpm - bin/cnpm
 *
 * Copyright(c) cnpmjs.org and other contributors.
 * MIT Licensed
 *
 * Authors:
 *  fengmk2 <fengmk2@gmail.com> (http://fengmk2.com)
 */

'use strict';

/**
 * Module dependencies.
 */

var debug = require('debug')('cnpm');
var pkg = require('../package.json');


var argv = require('../parse_argv')();

var action = argv.args[0];

if (action == 'install') {
  require('../check_latest'); // 自动检查仓库中最新的 tnpm 版本
}

if (action == 'team') {
  console.log('目前 tnpm 不支持 team 特性，团队管理请通过申请一个公用团队账号来进行。')
  process.exit(0)
}

if (action === 'unpublish') {
  console.log(`注意事项：请不要重复 unpublish 和 publish 同一个版本，这样会破坏 npm 的缓存机制`)
}

if (action === 'publish') {
  const cwd = process.cwd();
  if (cwd.indexOf('node_modules') !== -1) {
    console.log(`禁止从 node_modules 发布模块，package.json 处于污染状态，会有不必要的字段出现。`)
    process.exit(1);
  }
}

var ADDUSER_ACTION_RE = /adduser|add\-user|login/
if (ADDUSER_ACTION_RE.test(action)) {
  console.log('用户名请按 rtx + "_at_tencent" 命名，如：alsotang_at_tencent')
  console.log('邮箱请使用 @tencent.com 的后缀，如：alsotang@tencent.com')
  console.log('老用户忘记密码请查看 http://tnpm.oa.com/ 底部的 FAQ 第7条')
}

var extendsMethd = {
  web: 1,
  check: 1,
  doc: 1,
  sync: 1,
  user: 1,
  search: 1,
};

debug('cnpm %s', action);

if (extendsMethd[action]) {
  return require('./tnpm-' + action);
}




debug('origin npm with origin registry: $ npm %s', action);
require('../origin_npm.js');
